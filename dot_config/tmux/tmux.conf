# tmux show-options -A

# general settings
set -g mouse on
set-option -g history-limit 50000
set-option -g automatic-rename off # automatic renaming doesn't work well with pwsh
set-option -g allow-rename on # we use pwsh to set titles
set -g base-index 1 # start numbering windows at 1 as it makes selection easier

# split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# switch panes using Alt+arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# switch tabs (aka windows) using Ctrl+Alt+arrow
# bind -n C-Left select-window -p
# bind -n C-Right select-window -n
bind -n M-C-Left select-window -p
bind -n M-C-Right select-window -n
bind -n M-C-Up last-window
bind -n M-C-Down last-window

# move tabs around <prefix> Shift+Ctrl+arrow
bind-key -n S-C-Left swap-window -t -1
bind-key -n S-C-Right swap-window -t +1

# Use PowerShell as the default shell
# set-option -g default-shell /opt/microsoft/powershell/7/pwsh
set -g default-command 'pwsh -NoLogo'

# work with tabs (aka windows) <prefix> t goes into tab menu
bind-key t switch-client -TtableTab
bind-key -TtableTab n new-window -c "#{pane_current_path}"
bind-key -TtableTab c new-window -c "#{pane_current_path}"
bind-key -TtableTab r command-prompt "rename-window '%%'"
bind-key -TtableTab x kill-window

# reload config <prefix> Ctrl+c
bind-key C-c source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded..."

# clipboard settings
# https://github.com/tmux/tmux/wiki/Clipboard
set-option -s set-clipboard on
set-option -g allow-passthrough on

# tmux plugin manager
# https://github.com/tmux-plugins/list
set -g @plugin 'tmux-plugins/tpm'

# https://github.com/tmux-plugins/tmux-sensible
# common settings which don't override anything set above explicitly
set -g @plugin 'tmux-plugins/tmux-sensible'

# Theme
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavour 'frappe' # latte, frappe, macchiato or mocha

# https://github.com/tmux-plugins/tmux-resurrect
# https://github.com/tmux-plugins/tmux-continuum
# store and restore tmux sessions
# session state is stored in ~/.local/share/tmux/resurrect
set -g @continuum-restore 'on'
set -g @continuum-save-interval '5'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# set -g @plugin 'omerxx/tmux-sessionx'

# Has preview window to investigate
# set -g @plugin 'vndmp4/tmux-fzf-session-switch'
# set -g @fzf-goto-preview-enabled 'true'

# Link to action directly - https://github.com/sainnhe/tmux-fzf/issues/6
# e.g. bind-key "C-l" run-shell -b "/home/sainnhe/.tmux/plugins/tmux-fzf/scripts/session.sh"
set -g @plugin 'sainnhe/tmux-fzf'

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'

# Setup the sattus bar after loading plugins as the theme sets variables we want to use
# Theme colours - https://catppuccin.com/palette/
# Colour variables available in TMUX - https://github.com/catppuccin/tmux/blob/main/themes/catppuccin_frappe_tmux.conf
# Examples - https://github.com/catppuccin/tmux/discussions/317

# set -g status-style "bg=#{@thm_bg}"
set -g status on
set -g status-position bottom

set -g @catppuccin_status_background "none"
set -g @catppuccin_window_status_style "none"
set -g @catppuccin_pane_status_enabled "off"
set -g @catppuccin_pane_border_status "off"

# status left look and feel
# set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_peach},fg=#{@thm_bg},bold]  #{session_name} },#{?#{==:#{pane_mode},copy-mode},#[bg=#{@thm_pink} fg=#{@thm_bg} bold]  #{session_name} ,#{#[bg=default,fg=#{@thm_blue}]  #{session_name} }}}"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_maroon}]  #{pane_current_command} "
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_maroon}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
set -ga status-left "#[bg=default,fg=#{@thm_overlay_0},none]#{?window_zoomed_flag,│,}"
set -ga status-left "#[bg=default,fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}"

# status right look and feel
# set -g status-right-length 100
set -g status-right ""
# set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@thm_red},fg=#{@thm_bg}]},#{#[bg=#{@thm_bg},fg=#{@thm_pink}]}} #{battery_icon} #{battery_percentage} "
# set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
# set -ga status-right "#[bg=#{@thm_bg}]#{?#{==:#{online_status},ok},#[fg=#{@thm_mauve}] 󰖩 on ,#[fg=#{@thm_red},bold]#[reverse] 󰖪 off }"
# set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
set -ga status-right "#[bg=default,fg=#{@thm_blue}] 󰭦 %-d %b 󰅐 %H:%M "

# Window list formats
set -g window-status-format " #{window_index}: #{=/25/...:pane_title} "
# set -g window-status-current-format "#[bg=#{@thm_peach},fg=#{@thm_bg},bold] #{window_index} #[bg=default,fg=#{@thm_peach}]#{pane_title} "
set -g window-status-current-format " #{window_index}* #{=/25/...:pane_title} "

set -g window-status-current-style "bg=default,fg=#{@thm_lavender}"
set -g window-status-last-style "bg=default,fg=#{@thm_subtext_0}"
set -g window-status-style "bg=default,fg=#{@thm_overlay_0}"
set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"
set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"
set -gF window-status-separator "#[bg=default,fg=#{@thm_overlay_0}]│"
